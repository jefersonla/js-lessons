<!DOCTYPE html>
<html>
<title>js-lessons</title>
<meta charset="utf-8">
<!-- Theses are just icons config - created with realfavicongenerator.net -->
<link rel="apple-touch-icon" sizes="57x57" href="assets/images/icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="assets/images/icons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="assets/images/icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="assets/images/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="assets/images/icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="assets/images/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="assets/images/icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="assets/images/icons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="assets/images/icons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="assets/images/icons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="assets/images/icons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="assets/images/icons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="assets/images/icons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="assets/images/icons/manifest.json">
<link rel="mask-icon" href="assets/images/icons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="assets/images/icons/favicon.ico">
<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-TileImage" content="assets/images/icons/mstile-144x144.png">
<meta name="msapplication-config" content="assets/images/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- You can remove or leave at is -->
<link rel="stylesheet" href="assets/main.css">
<link rel="stylesheet" href="assets/codemirror/codemirror.css">
<link rel="stylesheet" href="assets/codemirror/addons/show-hint.css">
<link rel="stylesheet" href="assets/codemirror/addons/lint.css">
<link rel="stylesheet" href="assets/codemirror/addons/fullscreen.css">
<script type="text/javascript">
	// Adds the implementation for Array.prototype.concatAll()
	function defineConcatAll() {
		Array.prototype.concatAll = function () {
			var results = [];

			this.forEach(function(subArray) {
				results.push.apply(results, subArray);
			});

			return results;
		};
	}

	/**
	 * Add the implementation for Array.prototype.concatMap()
	 */
	function defineConcatMap() {
		Array.prototype.concatMap = function(fnc) {
			return this.
				map(function (e) {
					return fnc(e);
				}).
				// apply the concatAll function to flatten the two-dimensional array
				concatAll();
		};
	}

	/**
	 * This function will be executed at the begining of each verifier function
	 */
	function preVerifierHook() {
		// Add helpers to prevent 'undefined is not a function' like errors
		defineConcatAll();
		defineConcatMap();
	}

	function showLessonErrorMessage(exp, got, note, div){
		var preTag;
		var expected = JSON.stringify(JSON.parse(exp), undefined, 4);

		div.innerHTML = "<h4>Expected:</h4>";
		preTag = document.createElement("pre");
		preTag.innerHTML += expected;
		div.appendChild(preTag);
		div.innerHTML += "<h4>Got:</h4>";
		preTag = document.createElement("pre");
		preTag.innerHTML += got;
		div.appendChild(preTag);
		
		div.innerHTML += (note !== "") ? ("<h4>Note</h4><p style=\"margin-left: 25px;\">" + note + "</p>") : ""; 
		div.className = "info";
	}
</script>

<xmp theme="united" style="display:none;">
<div id="loader-wrapper">
	<div id="loader"></div>
	<div class="loader-section section-left"></div>
	<div class="loader-section section-right"></div>
</div>

# Welcome to js-lessons
### Interactive js exercises
---

## Preface



## Introduction

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore
et dolore magna aliqua. 

<div class="lesson">
	<textarea class="code" rows="8" cols="80">
/*jshint esversion: 6 */
function(console) { // jshint ignore:line
	var names = ["Ben", "Jafar", "Matt", "Priya", "Brian"],
		counter;

	for(counter = 0; counter < names.length; counter++) {
		console.log(names[counter]);
	}
}
	</textarea>
	<div class="output"></div>
	<div class="output"></div>
	<pre id="" class="verifier">
		// Traverse array with for loop
		function(str, info) {
			preVerifierHook();
			var fun = eval("(" + str + ")");
			var items = [];
			var got;
			var expected = '["Ben","Brian","Jafar","Matt","Priya"]';
			fun({
				log:function(name) {
					items.push(name);
					console.log(name);
				}
			});

			got = JSON.stringify(items.sort());
			if(got === expected) {
				return "Success!"
			}
			else {
				showLessonErrorMessage(expected, JSON.stringify(items.sort(), undefined, 4), 'Order does not matter', info);
			}
		}
	</pre>
	<button class="go">Run</button>
</div>
<!-- ********************** START OF EXERCISE ********************** -->
<div style="display:none;" id="START-EXERCISE"></div>
<!-- ********************** LESSON 1 - BEGIN *********************** -->
<div style="display:none;" id="lessonB1"></div>

## Chapter 2

Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
culpa qui officia deserunt mollit anim id est laborum.

<div class="lesson">
	<textarea class="code" rows="60" cols="80">
/*jshint esversion: 6 */
function() { // jshint ignore:line
	var newReleases = [
		{
			"id": 70111470,
			"title": "Die Hard",
			"boxart": "http://cdn-0.nflximg.com/images/2891/DieHard.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [4.0],
			"bookmark": []
		},
		{
			"id": 654356453,
			"title": "Bad Boys",
			"boxart": "http://cdn-0.nflximg.com/images/2891/BadBoys.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [5.0],
			"bookmark": [{ id:432534, time:65876586 }]
		},
		{
			"id": 65432445,
			"title": "The Chamber",
			"boxart": "http://cdn-0.nflximg.com/images/2891/TheChamber.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [4.0],
			"bookmark": []
		},
		{
			"id": 675465,
			"title": "Fracture",
			"boxart": "http://cdn-0.nflximg.com/images/2891/Fracture.jpg",
			"uri": "http://api.netflix.com/catalog/titles/movies/70111470",
			"rating": [5.0],
			"bookmark": [{ id:432534, time:65876586 }]
		}
	],
	videoAndTitlePairs = [];

	// ------------ INSERT CODE HERE! -----------------------------------
	// Use forEach function to accumulate {id, title} pairs from each video.
	// Put the results into the videoAndTitlePairs array using the Array's
	// push() method. Example: videoAndTitlePairs.push(newItem);
	// ------------ INSERT CODE HERE! -----------------------------------


	return videoAndTitlePairs;
}
	</textarea>
	<div class="output"></div>
	<div class="output"></div>
	<pre class="verifier">
		// Projection with with forEach
		function(str, info) {
			preVerifierHook();
			var fun = eval("(" + str + ")"),
				videoAndTitlePairs = fun(),
				expected = '[{\"id\":675465,\"title\":\"Fracture\"},{\"id\":65432445,\"title\":\"The Chamber\"},{\"id\":70111470,\"title\":\"Die Hard\"},{\"id\":654356453,\"title\":\"Bad Boys\"}]';

			// Sorting by video id
			videoAndTitlePairs = _.sortBy(videoAndTitlePairs, function(video) { return video.id });
			if (JSON.stringify(videoAndTitlePairs) === expected) {
				return true;
			}
			else {
				showLessonErrorMessage(expected, JSON.stringify(videoAndTitlePairs, undefined, 4), "", info);
			}
		}
	</pre>
	<button class="go">Run</button>
</div>
<div style="display:none;" id="lessonE1"></div> 
<!-- *********************** LESSON 2 - END *********************** -->
<!-- ********************** LESSON 2 - BEGIN ********************** -->
<div style="display:none;" id="lessonB2"></div> 

## Chapter 3

Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
culpa qui officia deserunt mollit anim id est laborum.

<div style="display:none;" id="lessonE2"></div>
<!-- *********************** LESSON 2 - END *********************** -->
<div style="display:none;" id="END-EXERCISE"></div>
<!-- ********************** END OF EXERCISE *********************** -->
</xmp>

<!-- Nice librarie for functional programming -->
<script type="text/javascript" src="assets/underscore/underscore-min.js"></script>

<!-- Since strapdown is stupid and can change the value of textarea, we need to make a backup of all code -->
<script type="text/javascript">
	/*
	(function() {
		var code;
		window.codeBackup = [];
		
		//while(document.getElementsByTagName("textarea") == 0){
			code = document.getElementsByTagName("textarea");	
			console.log(code);
			console.log("OXEE");
		//}

		_.each(code, (el) => {
			window.codeBackup.push({
				_el  : el,
				text : el.value
			});
		});
	})();
	*/

	/* Non functional */
	// Thanks StackOverflow!
	// http://stackoverflow.com/questions/1144783/replacing-all-occurrences-of-a-string-in-javascript
	replaceAll = function(search, replacement, object) {
	    return object.replace(new RegExp(search, 'g'), replacement);
	};
</script>

<!-- Libraries for interface -->
<script src="assets/strapdown/0.2/strapdown.js"></script>
<script src="assets/codemirror/codemirror.js"></script>
<!-- Some code mirrors addons -->
<script src="assets/codemirror/javascript.js"></script>
<script src="assets/codemirror/addons/matchbrackets.js"></script>
<script src="assets/codemirror/addons/autorefresh.js"></script>
<script src="assets/codemirror/addons/javascript-hint.js"></script>
<script src="assets/codemirror/addons/jshint.js"></script>
<script src="assets/codemirror/addons/javascript-lint.js"></script>
<script src="assets/codemirror/addons/lint.js"></script>
<script src="assets/codemirror/addons/show-hint.js"></script>
<script src="assets/codemirror/addons/fullscreen.js"></script>

<!-- APP LIBRARIES --> 
<script src="assets/app/wordlist.js"></script>
<!-- <script src="assets/app/utils.js"></script> -->
<!-- <script src="assets/app/main.js"></script> -->

<script type="text/javascript">
	// Hide the remain exercises without remove markdown support
	// Remember to use functional paradigm :p
	(function (){
		var x = document.getElementById("START-EXERCISE");
		while(x.nextElementSibling.id != "END-EXERCISE"){
			x.style.display = "none";
			x = x.nextElementSibling;
		}

		x = document.getElementsByClassName("code");
		_.each(x, el => {
			el.value = el.value.replace(/(<a\ href=").*(">)/g, 		"");
			el.value = el.value.replace(new RegExp("</a>", 'g'), 	"");
			el.value = el.value.replace(new RegExp("<em>", 'g'), 	"*");
			el.value = el.value.replace(new RegExp("</em>", 'g'), 	"*");
		});
	})();

	/*(function (){
		var x = document.getElementsByClassName("go");
		
		// Just unhide to confirm this possibility
		_.each(x, function(el) {
			el.onclick = (ev) =>  {


				p = ev.target.parentElement.nextElementSibling;
				while(!p.id.startsWith("lessonB")){
					p = p.nextElementSibling;
				}

				p = p.nextElementSibling;
				while(!p.id.startsWith("lessonE")){
					p.style.display = "";
					p = p.nextElementSibling;
				}

				p.previousElementSibling.scrollIntoView();
			}
		}); 
	})();*/
	
	var codeMirrorEditors = [];
	var lessons = document.getElementsByClassName("lesson");

	function scrollTo(element, to, duration) {
	    var difference 	= (to + 60) - element.scrollTop;
	    var perTickSize = (difference / duration).toFixed();
	    var perTickTime = (duration / difference).toFixed(2);
	    var pageHeight	= window.innerHeight;

	    console.log("St = " + perTickSize + " | Ts = " + perTickTime + " | S = " + difference + " | D = " + duration);

	    var scrollingId = setInterval( _ => {
	    	if((duration <= 0) || ((pageHeight + element.scrollTop) > element.offsetHeight)){
	    		clearInterval(scrollingId);
	    		return;
	    	}
	    	console.log(element.scrollTop);
	    	duration -= perTickTime;
	    	element.scrollTop = element.scrollTop + perTickSize;
	    }, perTickTime);		
	}

	_.each(lessons, function (el){
		var code = el.children[0];
		var output = el.children[1];
		var info = el.children[2]; 
		var verifierScript = el.children[3].textContent;
		var go = el.children[4];

		code.style.visibility = null;
		code.style.display = null;

		CodeMirror.defaults.lint = true;

		var codeMirror = CodeMirror.fromTextArea(code, {
			    lineNumbers: true,
			    mode: "javascript",
			    gutters: ["CodeMirror-lint-markers"],
			    lint: true,
				matchBrackets: true,
				autoRefresh: true,
				tabSize: 4,
				indentWithTabs: false,
				hint: true,
				extraKeys: {
					"F4": function(cm) {
						cm.setOption("fullScreen", !cm.getOption("fullScreen"));
					},
					"Esc": function(cm) {
						if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
					},
					"Ctrl-Space": "autocomplete"
				}
			});

		codeMirrorEditors.push(codeMirror);

		go.onclick = (ev) =>  {
			console.log("EVENT OK!");
			console.log(ev);
			try{
				var verificador = eval("(" + verifierScript + ")");
				output.textContent = verificador(codeMirror.getValue(), info, el);
			} catch (ex) {
				alert(ex);
			}

			if(output.textContent !== "Success!"){
				output.className = "error";
				output.textContent = "Error!";
				return;
			}

			output.className = "success";
			info.className = "output";

			var p = ev.target.parentElement.nextElementSibling;
			while(!p.id.startsWith("lessonB")){
				p = p.nextElementSibling;
			}

			p = p.nextElementSibling;
			while(!p.id.startsWith("lessonE")){
				p.style.display = "";
				p = p.nextElementSibling;
			}		

			//scrollTo(document.body, output.offsetTop, 600);
		};

		// Since text area only have javascript code, is not necessary left "<a href"
	});

	// After all page got rendered remove loader
	document.body.classList.add("loaded");
</script>

</html>
<!-- TODO
	+ Remember to use jekyll, I think it's a good idea for clean the code
	+ USE http://myjson.com/api to store JSON with progress of each student
	+ USE https://ihatetomatoes.net/create-custom-preloading-screen/ while markdown is parsed and content are hidding
-->